# 4. Linux權限管理

## 1. 權限

- `file`

  - col#1-3 - permission of **owner** (user)

  - col#4-6 - permission of **group**

  - col#7-9 - permission of **others** (neither user nor group)

    

  - 一般來説，權限：owner > group > others

  - 文件的owner不一定屬於文件的所屬組

    

  - permission

    - `r(4)` - read    - 文件内容可以被查看

    - `w(2)` - write   - 文件可以被修改（增刪改）

    - `x(1)` - execute - 文件可以當作脚本運行

    - `-(0)` - none    - null

      

- `directory`

  - permission

    - `r(4)` - read    - 該目錄下的文件可以被查看屬性 - `ls`

      - ==文件是否能夠查看與所在目錄沒有任何關係，與文件是否具有r權限==

    - `w(2)` - write   - 可以在該目錄下創建/刪除/修改文件（屬性）

      - ==文件是否被修改與所在目錄沒有任何關係，與文件是否具有w權限==

    - `x(1)` - execute - 可以進入該目錄 = key to entry

      - ==若目錄無x屬性，仍然可以在該目錄下創建/刪除/查看文件，可以通過絕對路徑的方式:)==

    - `-(0)` - none    - null

      

  - 對於`directory`而言，只有3類權限有意義

    - `---` - 沒有任何權限
    - `r-x` - 有讀權限
    - `rwx` - 有讀寫權限

## 2. chown/chmod

- `chown/chgrp` - change file owner and group

  ```bash
  [root@RHEL8-RHCE tutorj]# useradd user1
  [root@RHEL8-RHCE tutorj]# useradd user2
  [root@RHEL8-RHCE tutorj]# id user1
  uid=1001(user1) gid=1001(user1) groups=1001(user1)
  [root@RHEL8-RHCE tutorj]# id user2
  uid=1002(user2) gid=6702(user2) groups=6702(user2)
  
  [root@RHEL8-RHCE tutorj]# cd /home/user1
  [root@RHEL8-RHCE user1]# touch file
  [root@RHEL8-RHCE user1]# ll file
  -rw-r--r--. 1 root root 0 Jan 15 20:17 file
  
  # change ownership of file to user2
  [root@RHEL8-RHCE user1]# chown user2 file
  [root@RHEL8-RHCE user1]# ll file
  -rw-r--r--. 1 user2 root 0 Jan 15 20:17 file
  
  # change group of file to user1
  [root@RHEL8-RHCE user1]# chgrp user1 file
  [root@RHEL8-RHCE user1]# ll file
  -rw-r--r--. 1 user2 user1 0 Jan 15 20:17 file
  
  # merge
  [root@RHEL8-RHCE user1]# chown user2:user1 file
  [root@RHEL8-RHCE user1]# ll file
  -rw-r--r--. 1 user2 user1 0 Jan 15 20:17 file
  ```

- `chmod` - change file mode bits

  ```bash
  # syntax - user/group/others
  chmod u/g/o
  
  # = -> set 
  [root@RHEL8-RHCE user1]# chmod u=rwx,g=rwx,o=rwx file
  [root@RHEL8-RHCE user1]# ll file
  -rwxrwxrwx. 1 user2 user1 0 Jan 15 20:17 file
  
  # - -> remove
  [root@RHEL8-RHCE user1]# chmod u-x,g-wx,o-rwx file
  [root@RHEL8-RHCE user1]# ll file
  -rw-r-----. 1 user2 user1 0 Jan 15 20:17 file
  
  # + -> add
  [root@RHEL8-RHCE user1]# ll file
  -rwxrw-r--. 1 user2 user1 0 Jan 15 20:17 file
  ```

- Demo#1

  ```bash
  # create dir
  [root@RHEL8-RHCE tmp]# mkdir dir-test
  [root@RHEL8-RHCE tmp]# ls -ld dir-test/
  drwxr-xr-x. 2 root root 6 Jan 15 20:33 dir-test/
  [root@RHEL8-RHCE tmp]# touch dir-test/file
  
  # both user1 & user2 can access
  [user1@RHEL8-RHCE ~]$ cd /tmp/dir-test/                                             
  [user1@RHEL8-RHCE dir-test]$ ll                                                    
  total 0                                        
  -rw-r--r--. 1 root root 0 Jan 15 20:35 file
  [user2@RHEL8-RHCE ~]$ cd /tmp/dir-test/                                             
  [user2@RHEL8-RHCE dir-test]$ ll                                                    
  total 0                                        
  -rw-r--r--. 1 root root 0 Jan 15 20:35 file
  
  # remove x permission 
  [root@RHEL8-RHCE tmp]# chmod o-x dir-test/
  [root@RHEL8-RHCE tmp]# ll dir-test/
  total 0
  -rw-r--r--. 1 root root 0 Jan 15 20:35 file
  
  # user1 & user2 cannot access
  [user1@RHEL8-RHCE tmp]$ cd dir-test/                                                
  bash: cd: dir-test/: Permission denied 
  [user2@RHEL8-RHCE tmp]$ cd dir-test/                                                
  bash: cd: dir-test/: Permission denied 
  
  # change ownership
  [root@RHEL8-RHCE tmp]# chown user1:user2 dir-test/
  [root@RHEL8-RHCE tmp]# ls -ld dir-test/
  drwxr-xr--. 2 user1 user2 18 Jan 15 20:35 dir-test/
  
  # user1 is able to create
  [user1@RHEL8-RHCE tmp]$ cd dir-test/                                                
  [user1@RHEL8-RHCE dir-test]$ touch user1                                          
  [user1@RHEL8-RHCE dir-test]$ ll                                                     
  -rw-r--r--. 1 root  root  0 Jan 15 20:35 file                                       
  -rw-rw-r--. 1 user1 user1 0 Jan 15 20:43 user1
  
  # user2 is not allowed to create
  [user2@RHEL8-RHCE dir-test]$ touch user2
  [user1@RHEL8-RHCE dir-test]$ touch zk-test                                          
  touch: cannot touch 'user2': Permission denied
  
  # user1 can even delete file in root:root
  [user1@RHEL8-RHCE dir-test]$ ll                                                     
  total 0                                                                             
  -rw-r--r--. 1 root  root  0 Jan 15 20:35 file                                       
  -rw-rw-r--. 1 user1 user1 0 Jan 15 20:43 user1                                      
  [user1@RHEL8-RHCE dir-test]$ rm user1                                               
  [user1@RHEL8-RHCE dir-test]$ rm file                                                
  rm: remove write-protected regular empty file 'file'? y                             
  [user1@RHEL8-RHCE dir-test]$ ll                                                     
  total 0                                                                             
  [user1@RHEL8-RHCE dir-test]$ 
  ```

- Demo#2

  ```bash
  [root@RHEL8-RHCE dir-test]# vim file
  [root@RHEL8-RHCE dir-test]# ll
  total 4
  -rw-r--r--. 1 root user1 107 Jan 15 20:58 file
  
  # can't remove permission
  [user1@RHEL8-RHCE dir-test]$ chmod o-r file
  chmod: changing permissions of 'file': Operation not permitted
  
  # remove read from others
  [root@RHEL8-RHCE dir-test]# chmod o-r file
  [root@RHEL8-RHCE dir-test]# ll file
  -rw-r-----. 1 user1 root 107 Jan 15 20:58 file
  
  # change ownership to user1
  [root@RHEL8-RHCE dir-test]# chown user1 file
  [root@RHEL8-RHCE dir-test]# ll file
  -rw-r--r--. 1 user1 root 107 Jan 15 20:58 file
  
  # user1 can read
  [user1@RHEL8-RHCE dir-test]$ head -3 file
  sdfsdfsdfdfksdjfh sdfsdf
  sdf
  sdf
  
  # user2 can't read
  [user2@RHEL8-RHCE dir-test]$ cat file
  cat: file: Permission denied
  
  # +x for
  [user1@RHEL8-RHCE dir-test]$ touch test
  [user1@RHEL8-RHCE dir-test]$ ll
  total 4
  -rw-r--r--. 1 user1 root  107 Jan 15 20:58 file
  -rw-rw-r--. 1 user1 user1   0 Jan 15 21:10 test
  [user1@RHEL8-RHCE dir-test]$ chmod u+x test
  [user1@RHEL8-RHCE dir-test]$ ll test
  -rwxrw-r--. 1 user1 user1 0 Jan 15 21:10 test
  [user1@RHEL8-RHCE dir-test]$ cat > test << EOF
  > touch apple
  > touch orange
  > EOF
  [user1@RHEL8-RHCE dir-test]$ ./test
  [user1@RHEL8-RHCE dir-test]$ ll
  total 8
  -rw-rw-r--. 1 user1 user1   0 Jan 15 21:13 apple
  -rw-r--r--. 1 user1 root  107 Jan 15 20:58 file
  -rw-rw-r--. 1 user1 user1   0 Jan 15 21:13 orange
  -rwxrw-r--. 1 user1 user1  25 Jan 15 21:12 test
  
  ```

## 3. SUID/SGID/Sticky

- SUID
- SGID
- Sticky

## 4. mask

## 5. ACL

## 6. Extra

### 6.1 +openssl手動設置用戶密碼

### 6.2 sudoers

### 6.3 文件高級屬性

### 6.4 skel

### 6.5 Linux通用4道權限