[toc]

# 2. Linux文件管理

## 1 Linux命令行學前準備

### 1.1 操作系統工作原理

- ⽤户操作的是shell，shell向内核请求资源，内核通過驅動調用硬件资源，硬件处理后回到shell，⽤户通过shell查看结果

![image-20230107194251776](D:\rhce8\section1\img\image-20230107194251776.png)

### 1.2 操作系統知識模塊概述

- ⽂件管理（⽂件CRUD） 
- 进程管理（进程CRUD） 
- 软件管理（软件CRUD） 
- 权限管理 
- 用戶管理（同时⼀个⽤户使用系统）
- 網絡络管理（设置網絡，配置ip，wifi，有线）
- 防火墻管理 
- 磁盘管理

### 1.3 調整終端軟件大小和字體

```bash
# GUI -> Open Terminal
Ctrl + Shift + "+"
Ctrl + "-"
```

### 1.4 Linux命令行基礎命令學習

```bash
# print string 
# -e - escape
echo "<string>"
echo -e "123\n456"

# caculator (interactive)
bc

# evaluate expression (non-interactive)
expr

# print date
date

# concatenate files and print on the standard output - STDOUT
cat <file>

# change hostname & check
hostnamectl set-hostname <name>
hostname
```

### 1.6 執行Linux命令最重要的三件事

```bash
# root       - 當前CLI的用戶
# @          - 分隔符
# RHEL8-RHCE - 當前系統的主機名
# tutorj     - 當前工作目錄
# #          - 特權用戶
# $          - 普通用戶
[root@RHEL8-RHCE tutorj]$

# 我是誰 - who am I?
whoami

# 我在哪 - where am I?
pwd

# 我要幹什麽 - what I'm gonna do?
```

## 2 Linux文件管理

### 2.1 [Linux FSH](https://www.tecmint.com/linux-directory-structure-and-important-files-paths-explained/)

<img src="https://helpdeskgeek.com/wp-content/pictures/2020/02/file-directory.png" alt="img" style="zoom:150%;" />

### 2.2 su

- `su` - switch user

    - 普通用戶 -> any都需要pwd
    - root -> any都不需要pwd

    ```bash
    # 不帶“-”，只是shell層面上的切換，用戶的環境變量實際上沒有變化
    # 所以無論如何都要帶上，將變量context也一并切換到指定用戶下去執行對應的指令
    su - <user>
    
    # same
    su -
    su - root
    ```

- 當前shell進行用戶切換的時候，實際上是在當前的shell基礎上再打開一個shell

  ```bash
  [root@RHEL8-RHCE ~]$ pstree | grep bash
          |-sshd-+-sshd---sshd---bash---sudo---bash---su---bash---su---bash-+-grep
  [root@RHEL8-RHCE ~]$ exit
  logout
  [tutorj@RHEL8-RHCE ~]$ pstree | grep bash
          |-sshd-+-sshd---sshd---bash---sudo---bash---su---bash-+-grep
  [tutorj@RHEL8-RHCE ~]$ exit
  logout
  [root@RHEL8-RHCE tutorj]$ pstree | grep bash
          |-sshd-+-sshd---sshd---bash---sudo---bash-+-grep
  [root@RHEL8-RHCE tutorj]$ exit
  exit
  [tutorj@RHEL8-RHCE ~]$ pstree | grep bash
          |-sshd-+-sshd---sshd---bash-+-grep
  ```
  
- GUI

  ```bash
  # open a new terminal shell
  Ctrl + Shift + t 
  
  # switch between
  Alt + 1~9
  
  # close current terminal shell
  Ctrl + D
  ```

### 2.3 overview

- 文件的增刪改查
  - 文件的創建（文本文件/目錄文件）
  - 文件的刪除（文本文件/目錄文件）
  - 文件的修改（文件内容/屬性修改）
  - 文件的查看（文件内容/屬性查看）

### 2.4 abs/rel path

- absolute - staring with "/" - root directory
- relative - not staring with "/" - root directory

### 2.5 cd

- `cd` - change directory

  ```bash
  # 切換到指定的絕對or相對路徑
  cd <path>
  
  # 切換到上級目錄
  cd ..
  
  # 切換到當前用戶的家目錄/home/<user>
  cd
  cd ~
  
  # 切換到上次所在的目錄
  cd -
  ```

### 2.6 ls

- `ls` - list directory contents

  ```bash
  # list current directory contents
  ls
  
  # list contents of a specific directory/multiple directories
  ls <path>
  ls <path1> <path2> ...
  
  # flags
  # -l - use a long listing format
  # -h - human readable
  # -t - sort by modification time, newest first
  # -r - reverse order while sorting
  # -a - do not ignore entries starting with .
  # -d - list directories themselves, not their contents
  ls -lhtra
  ```

  ```bash
  # 第1列 - 文件的種類
  # “-” - file
  # “d” - directory
  # “b” - block
  # “l” - link
  
  # 第2列-第10列
  # rwx/ugo - read/write/execute - user/group/others
  
  # 第11列
  # "." - 表示該文件具備SELinux的安全上下文
  # “+” - 表示該文件具備ACL
  
  # 第12列
  # 該文件具備的inode數
  
  # 第13-14列
  # 該文件的擁有者和所屬組
  
  # 第15列
  # 文件的大小，單位字節Byte，1024Byte = 1KB
  
  # 第16列
  # 時間 - month day hour:minute
  
  # 第17列
  # 文件名
  
  [tutorj@RHEL8-RHCE ~]$ ls -l /boot/
  total 303172
  -rw-r--r--. 1 root root    192091 Apr 29  2021 config-4.18.0-305.el8.x86_64
  -rw-r--r--. 1 root root    198582 Oct  1 00:12 config-4.18.0-425.3.1.el8.x86_64
  drwxr-xr-x. 3 root root        17 Dec  6 23:13 efi
  drwx------. 4 root root        83 Jan  9 20:51 grub2
  -rw-------. 1 root root  53091373 Dec 13 23:26 initramfs-4.18.0-305.el8.x86_64.img
  -rw-------. 1 root root  27527168 Dec 13 23:19 initramfs-4.18.0-305.el8.x86_64kdump.img
  -rw-------. 1 root root  52981123 Dec 13 23:25 initramfs-4.18.0-425.3.1.el8.x86_64.img
  -rw-------. 1 root root  27515904 Dec 25 13:36 initramfs-4.18.0-425.3.1.el8.x86_64kdump.img
  drwxr-xr-x. 3 root root        21 Dec  6 23:20 loader
  -rw-------. 1 root root   4164308 Apr 29  2021 System.map-4.18.0-305.el8.x86_64
  -rw-------. 1 root root   4405925 Oct  1 00:12 System.map-4.18.0-425.3.1.el8.x86_64
  -rwxr-xr-x. 1 root root  10026352 Dec  6 23:23 vmlinuz-0-rescue-00ec32d126cd42898a54ddfc9bf8f035
  -rwxr-xr-x. 1 root root  10026352 Apr 29  2021 vmlinuz-4.18.0-305.el8.x86_64
  -rwxr-xr-x. 1 root root  10743152 Oct  1 00:12 vmlinuz-4.18.0-425.3.1.el8.x86_64
  ```

### 2.7 cat/tac/head/tail

- `cat` - concatenate files and print on the standard output - STDOUT

- `tat` - reverse of `cat`

  ```bash
  # interactive keyword input -> STDOUT
  # Ctrl + D to exit
  cat 
  
  # print file content to STDOUT
  cat <file>
  
  # print file content to STDOUT show line number
  cat -n <file>
  
  # combine file
  cat file1 file2 > file3
  ```

- `head` - output the first part of files

  ```bash
  # print 1st ten rows of content of file
  head <file>
  
  # print # of rows of content of file
  head -# <file>
  head -n <#> <file>
  ```

- `tail` - output the last part of files

  ```bash
  # print last 10 rows of content of file
  tail <file>
  
  # print last # of rows of content of file
  tail -# <file>
  tail -n <#> <file>
  
  # follow last 10 rows of content of file
  tail -f <file>
  ```

### 2.8 more/less

- `more` - file perusal filter for crt viewing

  - cat會一次性輸出文件内容到STDOUT，對於多行文件不友好
  - more可以進行分頁顯示，但不支持向前翻頁

  ```bash
  # paging display from top -> bottom
  # Enter - next row
  # Space - next page
  # q     - exit
  more <file>
  ```

- `less` - opposite of more

  - 支持向前翻頁

  ```bash
  # paging display from bottom -> top
  less <file>
  ```

### 2.9 touch/file

- `touch` - create a empty，change file timestamps

  ```bash
  # create a emtpy file
  touch <filename>
  
  # create multiple indexed using wildcard
  touch file{1..x}
  ```

- `file` - determine file type

  ```bash
  # check type of file
  file <file>
  ```

### 2.10 mtime/atime/ctime/stat

- `mtime` - 文件内容發生改變時，`mtime`會被更新（ls默認顯示）

- `atime` - 文件被訪問時，`atime`會被更新

- `ctime` - 文件狀態（屬性/權限）發生改變時，`ctime`會被更新

  ```bash
  # mtime
  [tutorj@RHEL8-RHCE Desktop]$ ls -l file
  -rw-rw-r--. 1 tutorj tutorj 14 Jan 12 20:58 file
  # atime
  [tutorj@RHEL8-RHCE Desktop]$ ls -lu file
  -rw-rw-r--. 1 tutorj tutorj 14 Jan 12 20:58 file
  # ctime
  [tutorj@RHEL8-RHCE Desktop]$ ls -lc file
  -rw-rw-r--. 1 tutorj tutorj 14 Jan 12 20:58 file
  
  # stat shows more comprehensive
  [tutorj@RHEL8-RHCE Desktop]$ stat file
    File: file
    Size: 14              Blocks: 8          IO Block: 4096   regular file
  Device: fd00h/64768d    Inode: 18443824    Links: 1
  Access: (0664/-rw-rw-r--)  Uid: ( 1000/  tutorj)   Gid: ( 1000/  tutorj)
  Context: unconfined_u:object_r:user_home_t:s0
  Access: 2023-01-12 20:58:20.966646687 +0800
  Modify: 2023-01-12 20:58:16.305596286 +0800
  Change: 2023-01-12 20:58:16.324596492 +0800
   Birth: 2023-01-12 20:58:16.305596286 +0800
  ```

### 2.11 mkdir

- `mkdir` - make directories

  ```bash
  # create a diretory
  mkdir <path/directory name>
  
  # -p - make parent directories as needed
  mkdir -p <path1/path2/directory name>
  ```

### 2.12 rm/rmdir

- `rm` - remove files or directories

  ```bash
  rm <file or directory>
  
  # -i - prompt
  # root will prompt automatically
  rm -i <file or directory>
  
  # -f - force
  rm -f <file>
  
  # remove non-empty directory recursively
  rm -r <directory>
  
  # force remove file & directory recursively
  rm -rf <file or directory>
  ```

- `rmdir` - remove directory

  ```bash
  # directory must be empty
  rmdir <directory>
  ```

### 2.13 alias

- `alias` - command alias

  ```bash
  # list alias
  alias
  
  # set alias temporarily, it's gone once current shell is closed
  alias <alias>='<cmd>'
  
  # set permenantly - add entry to .bashrc
  vim .bashrc
  
  # root alias -> auto prompt for removal
  alias rm='rm -i'
  ```

### 2.14 cp

- `cp` - copy files and directories -> backup (admin only)

  ```bash
  # cp scr1 & src2 to destination directory
  cp <src1> <src2> ... <dst directory>
  
  # cp src to destination directory & rename to crs
  cp <src> <dst directory/crs>
  
  # -r - copy directory recursively
  cp -r <dir1> <dir2>
  
  # -a - keep ownership & permission when using root = admin 
  cp -a <dir1> <dir2>
  
  # root alias -> auto prompt for cp
  alias cp='cp -i'
  
  # when doing backup, do remeber to add timestamp
  # %F - Equivalent to %Y - %m - %d
  # %T - Replaced by the time ( %H : %M : %S )
  touch file
  cp file file-`data +%F_%T`.bak
  ```

### 2.15 mv

- `mv` - move/rename file

  ```bash
  # src will be gone
  mv <src> <dst directory/crs>
  
  # rename
  mv <file1> <file2>
  mv <dir1> <dir2>
  ```

### 2.16 wildcard

- `?` - 非空任意字符

  ```bash
  [tutorj@RHEL8-RHCE Desktop]$ touch aa
  [tutorj@RHEL8-RHCE Desktop]$ touch aa1
  [tutorj@RHEL8-RHCE Desktop]$ touch aa2
  # list aa[?]
  [tutorj@RHEL8-RHCE Desktop]$ ls aa?
  aa1  aa2
  
  # create a file named "abc?"
  [tutorj@RHEL8-RHCE Desktop]$ touch abc?
  [tutorj@RHEL8-RHCE Desktop]$ ls
   aa   aa1   aa2  'abc?'
   
  # escape 
  [tutorj@RHEL8-RHCE Desktop]$ touch a\?
  [tutorj@RHEL8-RHCE Desktop]$ ls
  'a?'   aa   aa1   aa2  'abc?'
  [tutorj@RHEL8-RHCE Desktop]$ touch a\\
  [tutorj@RHEL8-RHCE Desktop]$ ls
  'a?'  'a\'   aa   aa1   aa2  'abc?'
  ```

- `[]` - 匹配“[ ]”包含的其中一個字符

  - [a-z] - 匹配所有的小寫字母
  - [a-Z] - 匹配所有字母
  - [0-9] - 匹配所有數字

  ```bash
  [tutorj@RHEL8-RHCE Desktop]$ touch abc acc a1c ac
  [tutorj@RHEL8-RHCE Desktop]$ ls a[abcdefg]c
  abc  acc
  [tutorj@RHEL8-RHCE Desktop]$ ls a[123]c
  a1c
  
  [tutorj@RHEL8-RHCE Desktop]$ ls [ab]?
  ac
  
  [tutorj@RHEL8-RHCE Desktop]$ ls a[1b]c
  a1c  abc
  
  # ^ - 取非
  [tutorj@RHEL8-RHCE Desktop]$ ls a[^1b]c
  acc
  ```

- `*` - 匹配任意字符

  ```bash
  [tutorj@RHEL8-RHCE Desktop]$ ls a*
  a1c  abc  ac  acc
  
  [tutorj@RHEL8-RHCE Desktop]$ ls *b?
  abc
  ```

### 2.17 VI/VIM

- Mode

  - 命令模式 - 一定要確定好光標所在的位置！

    - `h/l` - left/right

    - `j/k` - down/up

    - `gg` - move to 1st line 1st row

    - `G` - to last row

    - `n+G` - to nth row

    - `x` - remove char where current cursor is on

    - `X` - remove char left to current cursor is on

    - `u` - undo

      

    - `dd` - delete the row where current cursor is

    - `<#>dd` - delete # number of rows below current cursor

    - `yy` - cp the row where current cursor is

    - `<#>yy` - copy # number of rows below current cursor

    - `p` - paste the content from `dd` or `yy` below to the row of current cursor

    - `P` - paste the content from `dd` or `yy` above to the row of current cursor

      

  - 插入模式

    - `i` - start to insert txt left to current cursor
    - `I` - start to insert txt to the head of row of current cursor 
    - `a` - start to insert txt left to current cursor
    - `A` - start to insert txt to the tail of row of current cursor 
    - `o` - start to insert txt to the next row of current cursor
    - `O` - start to insert txt to the upper row of current cursor

    ```bash
    # Practice - 到配置文件486行下另起一行，添加Listen 2233
    # command mode
    486+G
    # press o to enter insert mode, start to insert txt to next row 
    o
    ```

    

  - 末行模式

    - `/` - find string

      - highlight all matched
      - `n` - to next matched one
      - `N` - to last matched one

    - `:` - 

      - `w`  - save

      - `q`  - quit

      - `q!` - force to quit (wont't)

      - `x`  - save & quit

      - `wq` - save & quit

      - `set nu`   - show row number

      - `set nonu` - hide row number

        

      - replace 

        ```bash
        # <row1>,<row2>s/<old content>/<new content>/g
        # starting from row1 to row2, substitude all old content to new content
        # g - glbal
        # if no g, only susbstitude the 1st matched in each row
        
        # from row 5 to 10, substitude all 123 to 456
        :5,10s/123/456/g
        
        # starting
        :1,$s///
        :1,$s///g
        
        # from row 1 to last row, substitude all 1.1.1.1 to 2.2.2.2
        # $ - last row
        :1,$s/1.1.1.1/2.2.2.2/g
        
        # escapse - \ if had special char
        # from row 1 to last row, substitude all /opt/aaa to /etc/bbb
        :1,$s/\/opt\/aaa/\/etc\/bbb/g
        ```

  - 可視化模式

    - `v` - Visual
    - `V` - Visual Line
    - `Ctrl+v` - Visual Block

  

- 異常處理 - 多用戶同時操作一個文本文件

  ```bash
  E325: ATTENTION
  Found a swap file by the name ".hosts.swp"
            owned by: tutorj   dated: Wed Jan 11 20:45:00 2023
           file name: ~tutorj/hosts
            modified: YES
           user name: tutorj   host name: RHEL8-RHCE.local
          process ID: 4660 (still running)
  While opening file "hosts"
               dated: Tue Jan 10 21:35:27 2023
  
  (1) Another program may be editing the same file.  If this is the case,
      be careful not to end up with two different instances of the same
      file when making changes.  Quit, or continue with caution.
  (2) An edit session for this file crashed.
      If this is the case, use ":recover" or "vim -r hosts"
      to recover the changes (see ":help recovery").
      If you did this already, delete the swap file ".hosts.swp"
      to avoid this message.
  
  Swap file ".hosts.swp" already exists!
  [O]pen Read-Only, (E)dit anyway, (R)ecover, (Q)uit, (A)bort:
  ```

  

- 教程

  ```bash
  vimtutor
  ```

## 3 Linux重定向 & 管道

### 3.0 重定向Summary

- Basic

  | cmd         | Description                                  |
  | ----------- | -------------------------------------------- |
  | cmd > file  | 輸出重定向到file                             |
  | cmd >> file | 輸出重定向追加到file                         |
  | cmd < file  | file輸入重定向到cmd                          |
  | n > file    | 將FD=0的文件輸出重定向到file                 |
  | n >> file   | 將FD=0的文件輸出重定向追加到file             |
  | n >& m      | 將輸出文件m和n合并                           |
  | n <& m      | 將輸入文件m和n合并                           |
  | << EOF      | 將開始標記EOF和結束標記EOF之間的内容作爲輸入 |

  

- Symbol

  | name   | number | symbol      |
  | ------ | ------ | ----------- |
  | stdin  | 0      | < <<        |
  | stdout | 1      | > >> 1> 1>> |
  | stderr | 2      | 2> 2>>      |

  

- What is `2>&1`?

  - ==將stderr重定向到stdout==

  - `>&`是一個整體，不可分開

  - 簡寫：&> file

    ```bash
    # example
    yum -y install aaa >> install.log 2>&1
    yum -y install httpd >> install.log 2>&1
    ```

### 3.1 STDOUT(1)/STDERR(2)

- 無論命令結果成功與否默認輸出到當前shell屏幕（若shell關閉則輸出永久丟失）

  ```bash
  # STDOUT - /dev/stdout
  # >  - overwrite
  # >> - appened
  [tutorj@RHEL8-RHCE ~]$ cat /etc/hosts
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  10.0.3.4    RHEL8-RHCE.local RHEL8-RHCE
  [tutorj@RHEL8-RHCE ~]$ cat /etc/hosts >> /dev/stdout
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  10.0.3.4    RHEL8-RHCE.local RHEL8-RHCE
  
  # STDERR - /dev/stderr
  # >  - overwrite
  # >> - appened
  [tutorj@RHEL8-RHCE ~]$ cat /etc/hosts >> /dev/stderr
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  10.0.3.4    RHEL8-RHCE.local RHEL8-RHCE
  
  # save cmd output to file
  <cmd> >  <file>
  <cmd> >> <file>
  # save cmd error to file
  <cmd> 2>  <file>
  <cmd> 2>> <file>
  # save both cmd output & error to file
  <cmd> &>  <file>
  <cmd> &>> <file>
  
  # redirect (meaningless or sensitive prints) to blackhole - /dev/null
  <cmd> &>> /dev/null
  ```

### 3.2 STDIN(0)

- 將原本由鍵盤的輸入，由文件來代替
- 可以將交互式命令轉換成交互式 -> :)script-friendly

- mail - send a mail

  ```bash
  # install
  [root@RHEL8-RHCE tutorj]$ dnf install evolution
  
  [root@RHEL8-RHCE tutorj]$ mail
  bash: mail: command not found...
  Install package 'mailx' to provide command 'mail'? [N/y] y
  
  # write a mail
  # -s - Subject
  [root@RHEL8-RHCE tutorj]$ mail -s "To tutorj" Tutorj
  Hello tutorj,
  
  This is root sending u the mail.
  
  Thanks!
  Elvis
  .
  EOT
  
  # check mail in tutorj
  [tutorj@RHEL8-RHCE ~]$ mail
  ```

  ```bash
  # <  - can only pass file (content) as input
  # letter as input to mail
  mail -s "To tutorj" < to_tutorj.letter
  
  # yes as input to cp 
  [tutorj@RHEL8-RHCE ~]$ echo y > yes
  [root@RHEL8-RHCE tutorj]$ cp /etc/hosts . < yes
  cp: overwrite './hosts'? [root@RHEL8-RHCE tutorj]$ 
  
  
  # << - end of file
  [tutorj@RHEL8-RHCE ~]$ mail -s "To tutorj" << EOF
  > Hello tutorj,
  > This is root tryting <<
  > Thanks!
  > Elvis
  > EOF
  
  # 
  [tutorj@RHEL8-RHCE ~]$ cat > config << EOF
  > This is a config file.
  > EOF
  [tutorj@RHEL8-RHCE ~]$ cat config
  This is a config file.
  ```

### 3.3 | 

- 管道的右側總是接受輸入的命令，其本質都是輸入重定向，後面跟著文件，將為文件的内容作爲輸入

  - mail
  - cat
  - head/tail
  - more/less

  ```bash
  # output of cmd1 as input to cmd2
  <cmd1> | <cmd2>
  
  [tutorj@RHEL8-RHCE ~]$ ls
  aaa  authorized_keys  config  Desktop  Documents  Downloads  hosts  log-261222-100207.log  Music  Pictures  Public  regex_practice.txt  Templates  Videos  
  [tutorj@RHEL8-RHCE ~]$ ls | cat
  aaa
  authorized_keys
  config
  Desktop
  Documents
  Downloads
  hosts
  log-261222-100207.log
  Music
  Pictures
  Public
  regex_practice.txt
  Templates
  Videos
  
  # output of "echo 123" as input to mail
  [tutorj@RHEL8-RHCE ~]$ echo 123 | mail -s "to tutorj" tutorj
  [tutorj@RHEL8-RHCE ~]$
  
  
  [tutorj@RHEL8-RHCE ~]$ cat << EOF
  > test
  > EOF
  test
  [tutorj@RHEL8-RHCE ~]$ head << EOF
  > test
  > EOF
  test
  [tutorj@RHEL8-RHCE ~]$ more << EOF
  > test
  > EOF
  test
  
  
  [tutorj@RHEL8-RHCE Desktop]$ echo "123" > file
  # output of ls as input to cat = cat (waiting input) then enter "file"
  [tutorj@RHEL8-RHCE Desktop]$ ls | cat
  file
  # output of ls as argument to cat = cat file
  [tutorj@RHEL8-RHCE Desktop]$ ls | xargs cat
  123
  ```

### 3.4 grep/egrep/fgrep

- `grep` - print lines matching a pattern

  ```bash
  # auto color
  [tutorj@RHEL8-RHCE ~]$ alias grep
  alias grep='grep --color=auto'
  
  # grep PATTERN [FILE...] - 注意必須要是文件
  [tutorj@RHEL8-RHCE Desktop]$ grep root /etc/passwd
  root:x:0:0:root:/root:/bin/bash
  operator:x:11:0:operator:/root:/sbin/nologin
  
  # -i - ignore case
  # -v - Invert the sense of matching
  # -A - Print NUM lines of trailing context after matching lines
  # -B - Print NUM lines of leading context before matching lines
  # -n - show line number
  # -E - regular expression = egrep
  # -c - count
  # -o - only matching
  
  # grep is also waiting for input 
  [tutorj@RHEL8-RHCE Desktop]$ grep a
  
  hello
  
  happy
  happy   # "a" is hightlighted
  
  [tutorj@RHEL8-RHCE Desktop]$
  
  # output of ls as input to grep then filter "i" = find file or directory which contains "i"
  [tutorj@RHEL8-RHCE Desktop]$ ls | grep i
  file
  # output of ls as argument = grep 1 file
  [tutorj@RHEL8-RHCE Desktop]$ ls | xargs grep 1
  123
  # which equals to 
  [tutorj@RHEL8-RHCE Desktop]$ grep 1 file
  123
  
  # print file & show last 10 rows
  cat file | tail
  # print file & show 1st 3 rows
  cat file | head -3
  
  # modify alias for grep
  [tutorj@RHEL8-RHCE ~]$ vi .bashrc
  [tutorj@RHEL8-RHCE ~]$ grep grep .bashrc
  alias grep='grep -E --color=auto'
  [tutorj@RHEL8-RHCE ~]$ source .bashrc
  
  # only match
  [tutorj@RHEL8-RHCE ~]$ grep -oi ^create_home /etc/login.defs
  CREATE_HOME
  
  # filter out all commented
  grep "^#" /etc/chrony.conf -v -n
  
  # filter out all commented & empty line
  grep "^#" /etc/chrony.conf -v | grep -v ^$ -n
  grep -vE "^#|^$" /etc/chrony.conf
  
  # find inet ip
  [tutorj@RHEL8-RHCE ~]$ ip a | grep -A2 'enp.*:' | grep -Eo '([0-9]{1,3}\.){3}[0-9]{1,3}' | grep -v '255$'
  10.0.3.4
  192.168.56.3
  ```

- `egrep` - 
- `fgrep` - 

### 3.5 regex

- regular expression （匹配文件内容，也可以匹配文件名但是部分規則是沒有的） vs 通配符（匹配文件名）

  ```bash
  # ^ - starting with 
  [tutorj@RHEL8-RHCE Desktop]$ grep a file
  aab
  abc
  ea
  af
  [tutorj@RHEL8-RHCE Desktop]$ grep ^a file
  aab
  abc
  af
  
  # $ - end with
  [tutorj@RHEL8-RHCE Desktop]$ grep a file
  aab
  abc
  ea
  af
  [tutorj@RHEL8-RHCE Desktop]$ grep a$ file
  ea
  
  # starting with a & end with b
  [tutorj@RHEL8-RHCE Desktop]$ grep ^a file | grep b$
  aab
  
  # . - 匹配任意一個非空字符
  [tutorj@RHEL8-RHCE Desktop]$ grep a file
  aab
  abc
  ea
  af
  [tutorj@RHEL8-RHCE Desktop]$ grep a. file
  aab
  abc
  af
  
  # .* - 匹配任意一個非空字符串 = 1~n個.
  [tutorj@RHEL8-RHCE Desktop]$ grep a file
  aab
  abc
  ea
  af
  [tutorj@RHEL8-RHCE Desktop]$ grep .* file -n
  grep: ..: Is a directory
  file:1:aab
  file:2:abc
  file:3:ea
  file:4:af
  
  # .? - 匹配任意2個非空字符 = 重複前面的字符1次或0次
  # .? = ..
  [tutorj@RHEL8-RHCE Desktop]$ grep .? file -n
  1:aab
  2:abc
  3:ea
  4:af
  ```

### 3.6 Help

- `man` - an interface to the on-line reference manuals
- `info` - read Info documents
- cmd --help
- RHEL Offical Doc
- Search Engine

### 3.7 Terminal Short-cut

- `Ctrl+l` - clear 

- `Ctrl+a` - move cursor to left most

- `Ctrl+e` - move cursor to right most

- `Ctrl+u` - remove content from current cursor to left most

- `Ctrl+y` - resume removal

- `Ctrl+w` - remove one word

  

- `↑` - list last cmd

- `↓` - list next cmd


### 3.8 history

- `history` - list cmd history

  ```bash
  # list history command
  [root@RHEL8-RHCE Desktop]$ history | tail -5
    838  Thanks!
    839  Elvis
    840  EOF
    841  exit
    842  history | tail -5
  
  # show command date
  # %F - Equivalent to %Y - %m - %d
  # %T - Replaced by the time ( %H : %M : %S )
  [root@RHEL8-RHCE Desktop]$ export HISTTIMEFORMAT='%F %T  '
  [root@RHEL8-RHCE Desktop]$ history | tail -5
    840  2023-01-12 21:44:26  EOF
    841  2023-01-12 21:44:26  exit
    842  2023-01-12 21:50:28  history | tail -5
    843  2023-01-12 21:51:22  export HISTTIMEFORMAT='%F %T  '
    844  2023-01-12 21:51:24  history | tail -5
  
  # ignore history cmd, : to separate
  export HISTIGNORE='ls -l:pwd:date:'
  
  # ignore duplicate cmd
  export HISTCONTROL=ignoredups
  
  # unset export
  unset export HISTCONTROL
  
  # save export permanently & make it effective
  [tutorj@RHEL8-RHCE ~]$ vi .bash_profile
  [tutorj@RHEL8-RHCE ~]$ cat .bash_profile | grep HIST
  export HISTTIMEFORMAT='%F %T  '
  [tutorj@RHEL8-RHCE ~]$ source .bash_profile
  
  # list specific user's executed command
  # each user keeps .bash_profile under /home/<user>
  [tutorj@RHEL8-RHCE ~]$ vi .bash_profile
  
  # disable history storing
  export HISTSIZE=0
  
  # clear history
  [tutorj@RHEL8-RHCE ~]$ history -c
  [tutorj@RHEL8-RHCE ~]$ history
      1  2023-01-12 21:58:51  history
  
  # search lastly executed command
  Ctrl + r
  (reverse-i-search)`hi': history 
  Press 'Enter'
  
  # recall last exectuted cmd
  [tutorj@RHEL8-RHCE ~]$ !1
  history
      1  2023-01-12 21:58:51  history
  
  # !l - execute latest cmd starting with "l"
  [tutorj@RHEL8-RHCE ~]$ !l
  ll
  total 44
  ...
  ```

### 3.9 tee

- `tee` - read from standard input and write to standard output and files

  - 接受STDIN同時輸出到STDOUT以及文件
  
  ```bash
  [tutorj@RHEL8-RHCE ~]$ last | tee last.tee | head -1
  tutorj   pts/0        10.0.3.2         Sun Jan 15 19:00   still logged in
  [tutorj@RHEL8-RHCE ~]$ cat last.tee
  tutorj   pts/0        10.0.3.2         Sun Jan 15 19:00   still logged in
  tutorj   pts/1        10.0.3.2         Sun Jan 15 13:41   still logged in
  tutorj   pts/0        10.0.3.2         Sun Jan 15 10:32 - 15:38  (05:05)
  tutorj   pts/3        10.0.3.2         Sun Jan 15 10:27 - 10:32  (00:04)
  tutorj   pts/1        10.0.3.2         Sun Jan 15 09:44 - 10:32  (00:48)
  tutorj   pts/0        10.0.3.2         Sun Jan 15 08:14 - 10:32  (02:17)
  ...
  ```

## 4 Extra

### 4.1 grep + cut

- `grep` -  filter row

  - `grep -E` = `egrep`

    

- `cut`  - filter col

  - `-d` - divide by separator

  - `-f` - field

  - `-c` - char

    
  ```bash
  # example#1
  [tutorj@RHEL8-RHCE ~]$ ip a | grep -E '[0-9]*\.' | grep '/' | awk '{print A$2}'
  127.0.0.1/8
  10.0.3.4/24
  192.168.56.3/32
  192.168.122.1/24
  [tutorj@RHEL8-RHCE ~]$ ip a | grep -E '[0-9]*\.' | grep '/' | awk '{print A$2}' | cut -d / -f 1
  127.0.0.1
  10.0.3.4
  192.168.56.3
  192.168.122.1
  [tutorj@RHEL8-RHCE ~]$ ip a | grep -E '[0-9]*\.' | grep '/' | awk '{print A$2}' | cut -d / -f 2
  8
  24
  32
  24

  # example 2
  [tutorj@RHEL8-RHCE ~]$ echo $PATH
  /home/tutorj/.local/bin:/home/tutorj/bin:/usr/share/Modules/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin
  [tutorj@RHEL8-RHCE ~]$ echo $PATH | cut -d : -f 1,3
  /home/tutorj/.local/bin:/usr/share/Modules/bin
  [tutorj@RHEL8-RHCE ~]$ echo $PATH | cut -d : -f 1-3
  /home/tutorj/.local/bin:/home/tutorj/bin:/usr/share/Modules/bin

  # example 3
  [tutorj@RHEL8-RHCE ~]$ for i in `cat /etc/passwd | cut -d ":" -f 1`
  > do
  > id $i
  > done
  uid=0(root) gid=0(root) groups=0(root)
  uid=1(bin) gid=1(bin) groups=1(bin)
  uid=2(daemon) gid=2(daemon) groups=2(daemon)
  uid=3(adm) gid=4(adm) groups=4(adm)
  uid=4(lp) gid=7(lp) groups=7(lp)
  uid=5(sync) gid=0(root) groups=0(root)
  uid=6(shutdown) gid=0(root) groups=0(root)
  uid=7(halt) gid=0(root) groups=0(root)
  uid=8(mail) gid=12(mail) groups=12(mail)

  # example4
  cut -c4 file   # 截取file中每行第4個字符
  cut -c1-4 file # 截取file中每行1-4個字符
  cut -c5- file  # 截取file中每行第5個字符開始后的所有
  ```

### 4.2 grep + regex

- regex - match file content

  | Symbol | Description       |
  | ------ | ----------------- |
  | ^      | 匹配開頭          |
  | $      | 匹配結尾          |
  | .      | 匹配任意1個字符   |
  | .*     | 匹配0個or多個字符 |
  | h*     | 匹配0個或多個h    |
  | h+     | 匹配1個或多個h    |
  | h?     | 匹配0個或1個h     |
  | h{2}   | 匹配2個h          |
  | [abc]  | 匹配a或b或c       |
  | [a-z]  | 匹配小寫英文字符  |
  | [A-Z]  | 匹配大寫英文字符  |
  | [a-Z]  | 匹配所有英文字符  |
  | [0-9]  | 匹配所有數字字符  |
  | \|     | or                |
  | ()     | combine           |

  | Expression | Description                    | Example         | Description           |
  | ---------- | ------------------------------ | --------------- | --------------------- |
  | [:alnum:]  | 大小寫字母和數字               | [[:alnum:]]+    | 匹配1或多個字符和數字 |
  | [:alpha:]  | 大小寫字母                     | [[:alpha:]]{4}  | 匹配4個字母           |
  | [:blank:]  | 空格與制表符                   | [[:blank:]]*    | 匹配0個或多個空格     |
  | [:digit:]  | 數字                           | [[:digit:]]？   | 匹配0或1個數字        |
  | [:lower:]  | 小寫字母                       | [[:lower:]]{4,} | 匹配至少4個小寫字母   |
  | [:upeer:]  | 大寫字母                       | [[:upeer:]]+    | 匹配1個或多個大寫字母 |
  | [:punct:]  | 標點                           | [[:punct:]]     | 匹配標點              |
  | [:space:]  | 包括換行符，回車在内的所有空行 | [[:space:]]+    | 匹配1個或多個空行     |

- practice

  ```bash
  # create file under /tmp
  cat > /tmp/regex_practice << EOF 
  caaat
  catdog
  
  cat2dog
  catanddog
  dogcat
  ccat
  catdogcccc
  c1235
  
  c45678t
  Cat
  cAt
  
  catdogDogCAT
  #this is a cat
  ;this is a dog 
  $a
  
  EOF
  ```

  ```bash
  grep "cat" /tmp/regex_practice
  grep -i "cat" /tmp/regex_practice          # 忽略大小寫
  grep -o "cat" /tmp/regex_practice          # only cat
  
  grep ^cat /tmp/regex_practice              # 以cat為開頭
  grep dog$ /tmp/regex_practice              # 以dog為結尾
  grep ^catdog$ /tmp/regex_practice          # catdog
  
  grep ^cat.*dog$ /tmp/regex_practice        # 以cat為開頭，dog為結尾，中間0個或多個字符
  grep ^cat.dog$ /tmp/regex_practice         # 以cat為開頭，dog為結尾，中間1個字符
  grep ^cat...dog$ /tmp/regex_practice       # 以cat為開頭，dog為結尾，中間3個字符
  grep -E ^cat.{3}dog$ /tmp/regex_practice   # 以cat為開頭，dog為結尾，中間3個字符, {}記得-E
  
  grep ^c[0-9]*t$ /tmp/regex_practice        # 以c開頭，t結尾，中間0個或多個數字
  grep -E ^"[#;]" /tmp/regex_practice        # 以#或者；為開頭
  grep -e ^"#" -e ^";" /tmp/regex_practice   # multiple regex
  ```

  ```bash
  # or
  [tutorj@RHEL8-RHCE ~]$ grep "root|ftp|adm" /etc/passwd
  root:x:0:0:root:/root:/bin/bash
  adm:x:3:4:adm:/var/adm:/sbin/nologin
  operator:x:11:0:operator:/root:/sbin/nologin
  ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
  
  # combine
  [tutorj@RHEL8-RHCE ~]$ cat > test << EOF
  > hello
  > myself
  > yourself
  > EOF
  [tutorj@RHEL8-RHCE ~]$ grep "(my|your)self" test
  myself
  yourself
  ```

### 4.3 sed

- `sed` - stream editor for filtering and transforming text

  - 主要用法：自動編輯1個或躲過文件；簡化對文件的反復操作；替換配置文件
  - :) - non-interactive in script
  - 默認不會真正執行，只有-i才會執行
    - sed首先把當前正在處理的行保存到臨時緩衝區，完成后輸出到屏幕，因此不會對源文件造成影響
  
  ```bash
  # -e - 多項編輯
  # -n - 取消默認輸出
  # -f - 指定sed脚本文件
  # -r - 使用擴展regex
  # -i - inplace，修改文件 = 落盤 = flush
  sed [option] 'sed命令|地址定位' file
  ```
  
  ```bash
  # delete Nth row
  sed -i 'Nd' file
  
  # delete N~Mth row
  sed -i 'N,Md' file
  
  # delete last row
  sed -i "$d" file
  
  # delete rows contain "cat"   -> commonly used
  sed -i '/cat/d' file
  ```
  
  ```bash
  # insert before Nth row
  sed 'Ni <content>' file
  
  # append to Nth row
  sed 'Na <content>' file
  
  # insert before row starting with "ccat"
  sed '/^ccat/i <content>' file
  
  # append to row starting with "ccat"
  sed '/^ccat/a <content>' file
  ```
  
  ```bash
  # similar to "1,$s///"" in vim
  
  # substitude -> commonly used, starting "s///"
  sed 's/<old>/<new>' file
  sed 's/<old>/<new>/g' file
  
  sed 's/^SELINUX=.*/SELINUX=permissive/' /etc/selinux/config
  ```
  
  ```bash
  # print Nth row
  sed -n 'Np' file
  
  # print Nth row to last row
  sed -n 'N,$p' file
  ```
  
  ```bash	
  # example#1
  [tutorj@RHEL8-RHCE ~]$ df -hl | sort -n -t' ' -b -k5 | sed -n '2p' | sed -r 's/[[:space:]]+/ /g' | cut -d ' ' -f5 | cut -d '%' -f1
  0
  ```

### 4.4 awk

- `awk` - pattern scanning and processing language

  - break file content to matrix - row & col(*)
  
  ```bash
  # print 
  awk '{print}' /etc/passwd
  awk '{print $0}' /etc/passwd
  ```
  
  ```bash
  # print row = sed -n 'Xp' file
  awk 'NR==X' /etc/passwd
  awk 'NR==X,NR==Y' /etc/passwd
  ```
  
  ```bash
  # print col
  awk -F ":" '{print $X,$Y}' /etc/passwd
  awk -F ":" '{print "uid: "$X, "\tgid is: "$Y}' /etc/passwd
  awk -F ":" 'NR==Z{print "Col#3 is: "$X, "\tCol#4 is: "$Y}' /etc/passwd
  
  # print last col
  awk -F ":" '{print $NF}' /etc/passwd
  # print 1st N col
  awk -F ":" 'NF=5' /etc/passwd
  
  
  # example
  [tutorj@RHEL8-RHCE ~]$ ifconfig | grep -A1 enp0s3 | grep inet | awk '{print $2}'
  10.0.3.4
  ```
  
  ```bash	
  # remove emtpy row
  awk NF file
  ```

### 4.5 screen (epel repo)

- `screen` - screen manager with VT100/ANSI terminal emulation <span style="color:red">(Deprecated)</span>
  
- 保證指令不會因ssh的終端而停止
  
- **ssh username@host_ip**

  - `sshd parent process` -> `sshd child process` -> `bash shell` -> `script cmd`
  - 儅關閉shell terminal窗口時sshd subprocess會被殺掉，進而後面bash shell和script cmd也都會停止:(

  ```bash
  # install screen
  yum -y install epel-release
  yum -y install screen
  
  # create a screen session, it won't interrupt ssh 
  screen -S <scoket name>
  
  # list screen session
  screen -ls
  
  # resume session
  screen -r <socket number>.<socket name>
  
  # dettach temorarily
  Ctrl + a then press d
  
  # -x - Attach to a not detached screen. (Multi display mode = Share screen)
  scree -x <socket number>.<socket name>
  ```

### 4.6 tmux (baseos repo)

- `tmux` - terminal multiplexer

  - better than `screen`
  - 可以在一個terminal上分裂出很多個session
- session一旦生成，就會和`bash shell`脫離，即便`sshd parent process`中斷導致`bash shell`中斷，也不會影響`tmux`
  
  ```bash
  # install
  yum -y tmux
  
  # create session 
  tmux -L <session name>
  
  # list session
  tmux ls
  
  # resume session
  tmux attach -t <session name>
  
  # dettach temporarily
  Ctrl + b then press d
  
  # ↑ ↓ split
  Ctrl + b then press “
  # ← → split
  Ctrl + b then press %
  # switch between session
  Ctrl + b then press ↑↓←→
  
  # show time
  Ctrl + b then press t
  
  # session folder
  /tmp/tmux-0
  ```

### 4.7 $PS1

- Linux ENV loading

  - `/etc/profile` -> `/etc/profile.d/*.sh` -> `~/.bash_profile` -> `~/.bashrc` -> `/etc/bashrc`

    ```bash
    # $PS1 env

    # [ - [
    # \u - user
    # @  - @
    # \h - hostname
    #    - space
    # \W - relative working directory
    # \w - absolute working directory
    # ]  - ]
    # $ - normal user
    # # - super user
    [tutorj@RHEL8-RHCE ~]$ echo $PS
    $PS1  $PS2  $PS4
    [tutorj@RHEL8-RHCE ~]$ echo $PS1
    [tutorj@RHEL8-RHCE ~]$ echo $PS1
    [\u@\h \W]\$
    [tutorj@RHEL8-RHCE ~]$ echo $PS2
    >
    [tutorj@RHEL8-RHCE ~]$ echo $PS3

    [tutorj@RHEL8-RHCE ~]$

    # export temp
    # %F - Equivalent to %Y - %m - %d
    # %T - Replaced by the time ( %H : %M : %S )
    export PS1='(`date +"%T"`)[\u@\h \W]\$ '

    # persist in .bashrc
    ```

### 4.8 gzip

- `gzip/gunzip`  - compress or decompress files

- `zcat`  - uncompresses either a list  of files on the cmd line or its STDIN and writes the uncompressed data on STDOUT

- `zmore/zless` - file perusal filter for crt viewing of compressed text

  ```bash
  # -c ：将压缩的数据输出到屏幕上，可通过数据流重导向来处理；
  # -d ：解压缩的参数；
  # -t ：可以用来检验一个压缩文件的一致性～看看文件有无错误；
  # -v ：可以显示出原文件/压缩文件的压缩比等信息；
  # -# ：# 为数字的意思，代表压缩等级，-1 最快，但是压缩比最差、-9 最慢，但是压缩比最好！默认是 -6
  gzip [option] file
  
  # zip - original file will be gone
  [tutorj@RHEL8-RHCE ~]$ gzip -v hosts
  hosts:   60.1% -- replaced with hosts.gz
  [tutorj@RHEL8-RHCE ~]$ ll | grep hosts
  -rw-r--r--. 1 tutorj tutorj 103 Jan 15 16:13 hosts.gz
  
  # zcat
  [tutorj@RHEL8-RHCE ~]$ zcat hosts.gz
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  10.0.3.4    RHEL8-RHCE.local RHEL8-RHCE
  
  # unzip
  [tutorj@RHEL8-RHCE ~]$ gzip -d hosts.gz
  [tutorj@RHEL8-RHCE ~]$ ll | grep hosts
  -rw-r--r--. 1 tutorj tutorj 198 Jan 15 16:13 hosts
  [tutorj@RHEL8-RHCE ~]$ gunzip hosts.gz
  [tutorj@RHEL8-RHCE ~]$ ll | grep hosts
  -rw-r--r--. 1 tutorj tutorj 198 Jan 15 16:13 hosts
  
  # zmore/zless
  zmore *.gz
  zless *.gz
  ```

### 4.9 bzip2

- `bzip2/bzunip2` - a block-sorting file compressor/decompressor

- `bzcat` - decompresses all specified files to the standard output

- `bzmore/bzless` - file perusal filter for crt viewing of bzip2 compressed text

- `bzgrep/bzegrep/bzfgrep` - search possibly bzip2 compressed files for a regular expression

- `bzip2recover` - recovers data from damaged bzip2 files

  ```bash	
  # -c ：将压缩的过程产生的数据输出到屏幕上！
  # -d ：解压缩的参数
  # -k ：保留原始文件，而不会删除原始的文件喔！
  # -z ：压缩的参数 （默认值，可以不加）
  # -v ：可以显示出原文件/压缩文件的压缩比等信息；
  # -# ：与 gzip 同样的，都是在计算压缩比的参数， -9 最佳， -1 最快！
  bzip2 [option] file
  
  # zip
  [tutorj@RHEL8-RHCE ~]$ bzip2 -v hosts
    hosts:    1.623:1,  4.929 bits/byte, 38.38% saved, 198 in, 122 out.
  [tutorj@RHEL8-RHCE ~]$ ll | grep hosts
  -rw-r--r--. 1 tutorj tutorj 122 Jan 15 16:13 hosts.bz2
  
  # cat
  [tutorj@RHEL8-RHCE ~]$ bzcat hosts.bz2
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  10.0.3.4    RHEL8-RHCE.local RHEL8-RHCE
  
  # grep
  [tutorj@RHEL8-RHCE ~]$ bzgrep RHEL hosts.bz2
  10.0.3.4    RHEL8-RHCE.local RHEL8-RHCE
  
  # unzip
  [tutorj@RHEL8-RHCE ~]$ bzip2 -d hosts.bz2
  [tutorj@RHEL8-RHCE ~]$ ll | grep hosts
  -rw-r--r--. 1 tutorj tutorj 198 Jan 15 16:13 hosts
  [tutorj@RHEL8-RHCE ~]$ bunzip2 hosts.bz2
  [tutorj@RHEL8-RHCE ~]$ ll | grep hosts
  -rw-r--r--. 1 tutorj tutorj 198 Jan 15 16:13 hosts
  ```

### 4.10 xz

- `xz/unxz` - Compress or decompress .xz files

- `xzcat` - decompresses all specified files to the standard output

- `xzmore/xzless` - view xz compressed (text) files

- `xzgrep/xzegrep/xzfgrep` - search compressed files for a regular expression

  ```bash	
  # -d ：就是解压缩啊！
  # -t ：测试压缩文件的完整性，看有没有错误
  # -l ：列出压缩文件的相关信息
  # -k ：保留原本的文件不删除～
  # -c ：同样的，就是将数据由屏幕上输出的意思！
  # -# ：同样的，也有较佳的压缩比的意思！
  xz [option] file
  
  # zip
  [tutorj@RHEL8-RHCE ~]$ xz -v hosts
  hosts (1/1)
    100 %               144 B / 198 B = 0.727
  [tutorj@RHEL8-RHCE ~]$ ll | grep hosts
  -rw-r--r--. 1 tutorj tutorj 144 Jan 15 16:13 hosts.xz
  
  # cat
  [tutorj@RHEL8-RHCE ~]$ xzcat hosts.xz
  127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
  ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
  10.0.3.4    RHEL8-RHCE.local RHEL8-RHCE
  
  # grep
  [tutorj@RHEL8-RHCE ~]$ xzgrep RHEL8-RHCE hosts.xz
  10.0.3.4    RHEL8-RHCE.local RHEL8-RHCE
  
  # unzip
  [tutorj@RHEL8-RHCE ~]$ xz -d hosts.xz
  [tutorj@RHEL8-RHCE ~]$ ll | grep hosts
  -rw-r--r--. 1 tutorj tutorj 198 Jan 15 16:13 hosts
  [tutorj@RHEL8-RHCE ~]$ unxz hosts.xz
  [tutorj@RHEL8-RHCE ~]$ ll | grep hosts
  -rw-r--r--. 1 tutorj tutorj 198 Jan 15 16:13 hosts
  ```

### 4.11 tar

- `tar` - an archiving utility

  ```bash
  # -z ：通过 gzip 的支持进行压缩/解壓縮：此时文件名最好为  *.tar.gz
  # -j ：通过 bzip2 的支持进行压缩/解壓縮：此时文件名最好为 *.tar.bz2
  # -J ：通过 xz 的支持进行压缩/解壓縮：此时文件名最好为    *.tar.xz
  
  # -f : 处理的文件名！建议 -f 单独写一个选项啰！
  # -p ：保留备份数据的原本权限与属性，常用于备份（-c）重要的配置文件
  # -P ：保留绝对路径，亦即允许备份数据中含有根目录存在之意
  # -v ：在压缩/解压缩的过程中，将正在处理的文件名显示出来！
  
  # zip - c
  # -x ：解打包或解压缩的功能，可以搭配 -C （大写） 在特定目录解开
  # -c ：创建打包文件，可搭配 -v 来察看过程中被打包的文件名（filename）
  [tutorj@RHEL8-RHCE ~]$ time tar -zpc -f etc.tar.gz /etc 2> /dev/null
  real    0m1.229s
  user    0m1.144s
  sys     0m0.043s
  [tutorj@RHEL8-RHCE ~]$ time tar -jpc -f etc.tar.bz2 /etc 2> /dev/null
  real    0m2.606s
  user    0m2.498s
  sys     0m0.044s
  [tutorj@RHEL8-RHCE ~]$ time tar -Jpc -f etc.tar.xz /etc 2> /dev/null
  real    0m16.264s
  user    0m15.803s
  sys     0m0.146s
  [tutorj@RHEL8-RHCE ~]$ ll -h | grep etc | awk '{print $5,$9}' | sort -nr
  8.4M etc.tar.gz
  6.7M etc.tar.bz2
  5.6M etc.tar.xz
  
  # zip & exclude
  # --exclude
  [tutorj@RHEL8-RHCE ~]$ tar -zc -f tutorj_home.tar.gz --exclude=Desktop --exclude=Documents .
  [tutorj@RHEL8-RHCE ~]$ tar -zt -f tutorj_home | egrep "Desktop|Documents"
  [tutorj@RHEL8-RHCE ~]$
  
  # zip only newer time
  # --newer       -  newer than mtime（内容修改） & ctime（權限屬性修改）
  # --newer-mtime -  only mtime（内容修改）
  tar -zc -f newer.tar.gz --newer-mtime="yyyy/mm/dd" /etc/*
  
  # check
  # -t ：察看打包文件的内容含有哪些文件名，重点在察看“文件名”就是了
  [tutorj@RHEL8-RHCE ~]$ tar -zt -f etc.tar.gz | head -3
  etc/
  etc/mtab
  etc/fstab
  [tutorj@RHEL8-RHCE ~]$ tar -jt -f etc.tar.bz2 | head -3
  etc/
  etc/mtab
  etc/fstab
  [tutorj@RHEL8-RHCE ~]$ tar -Jt -f etc.tar.xz | head -3
  etc/
  etc/mtab
  etc/fstab
  
  # unzip - x
  # -C ：这个选项用在解压缩，若要在特定目录解压缩，可以使用这个选项
  tar -zx -f etc.tar.gz -C .
  tar -jx -f etc.tar.bz2 -C .
  tar -Jx -f etc.tar.xz -C .
  
  # zip only a file - get from check
  [tutorj@RHEL8-RHCE ~]$ tar -zt -f etc.tar.gz | grep shadow
  etc/pam.d/sssd-shadowutils
  [tutorj@RHEL8-RHCE ~]$ tar -zx -f etc.tar.gz etc/pam.d/sssd-shadowutils
  [tutorj@RHEL8-RHCE ~]$ ll etc/pam.d/sssd-shadowutils
  -rw-r--r--. 1 tutorj tutorj 214 Oct 14 05:01 etc/pam.d/sssd-shadowutils
  ```

### 4.12 sort/uniq/wc

- `sort` - sort lines of text files

  - 以每一行作爲一個單位，從首字符向後，一次按ASCII碼值進行比較，最終升序輸出

  ```bash
  # -u      - 去除重複行
  # -r      - 降序排列，默認升序
  # -o      - 結果輸出到文件
  # -n      - 以數字排序，默認按字符排序
  # -t      - 分隔符
  # -k      - 第N列
  # -b      - 忽略
  # -R      - 隨機排序
  # --debug - underscore
  
  # 以:為分隔符，根據uid降序排序
  # 65534 -> 1000 -> 999
  [tutorj@RHEL8-RHCE ~]$ sort -n -r -t: -k3 /etc/passwd | head -3
  nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin
  tutorj:x:1000:1000:tutorj:/home/tutorj:/bin/bash
  systemd-coredump:x:999:997:systemd Core Dumper:/:/sbin/nologin
  
  # sort disk usage
  [tutorj@RHEL8-RHCE ~]$ df | grep -v 'Used' | sort -k5nr
  /dev/mapper/rhel-root  13092864 8313884   4778980  64% /
  /dev/sda1               1038336  349488    688848  34% /boot
  tmpfs                    928120     996    927124   1% /run
  devtmpfs                 898020       0    898020   0% /dev
  tmpfs                      1024       0      1024   0% /run/stratisd/keyfiles
  tmpfs                    185624       0    185624   0% /run/user/1000
  tmpfs                    928120       0    928120   0% /dev/shm
  tmpfs                    928120       0    928120   0% /sys/fs/cgroup
  ```

  ```bash	
  # practice
  cat > sort_practice << EOF
  apple:10:2.5
  orange:20:3.4
  banana:30:5.5
  pear:90:2.3
  grape:40:5.5
  EOF
  
  cat sort_practice | sort -t: -k2rn | cut -d: -f1
  cat sort_practice | sort -t: -k3rn --debug 
  
  # 第3列的第1個字符降序排序
  cat sort_practice | sort -t: -k3.1rn --debug
  ```

- `uniq` - report or omit repeated lines

  ```bash	
  [tutorj@RHEL8-RHCE ~]$ last | cut -d ' ' -f1 | sort | uniq
  
  reboot
  root
  tutorj
  wtmp
  
  # count
  [tutorj@RHEL8-RHCE ~]$ last | cut -d ' ' -f1 | sort | uniq -c
        1
       36 reboot
        7 root
       52 tutorj
        1 wtmp
  
  ```

- `wc` - print newline, word, and byte counts for each file

  ```bash	
  [tutorj@RHEL8-RHCE ~]$ cat /etc/man_db.conf | wc
      131     721    5165
  # row count
  [tutorj@RHEL8-RHCE ~]$ cat /etc/man_db.conf | wc -l
  131
  # word count
  [tutorj@RHEL8-RHCE ~]$ cat /etc/man_db.conf | wc -w
  721
  # char count
  [tutorj@RHEL8-RHCE ~]$ cat /etc/man_db.conf | wc -m
  5165
  
  ```

### 4.13 find

- `find` - search for ==files== in a directory hierarchy

  ```bash	
  # syntax
  find [PATH] [option] [action]
  ```

  ```bash
  # 1. mtime/atime/ctime
  # -mtime n ：n 为数字，意义为在 n 天之前的“一天之内”（24h前）被更动过内容的文件；
  # -mtime +n ：列出在 n 天之前（不含 n 天本身）被更动过内容的文件文件名；
  # -mtime -n ：列出在 n 天之内（含 n 天本身）被更动过内容的文件文件名。
  # -newer file ：file 为一个存在的文件，列出比 file 还要新的文件文件名
  
  # 0天前24小時内mtime發生變化的文件
  [tutorj@RHEL8-RHCE ~]$ find / -mtime 0 | head -3
  find: ‘/boot/efi/EFI/redhat’: Permission denied
  find: ‘/boot/grub2’: Permission denied
  find: ‘/boot/loader/entries’: Permission denied
  /boot/grub2
  /dev
  /dev/vcsa6
  
  # 3天譴24小時内mtime發生變化的文件
  [tutorj@RHEL8-RHCE ~]$ find / -mtime 3 2> /dev/null | head -3
  /etc/pki/product
  /etc/highlight
  /var/lib/rpm/Obsoletename
  
  # 大於等於5天前所有mtime發生變化的文件
  [tutorj@RHEL8-RHCE ~]$ find /var -mtime +4 2> /dev/null | head -3
  /var
  /var/lib
  /var/lib/dnf/modulefailsafe
  
  # 4天前導現在所有mtime發生變化的文件
  [tutorj@RHEL8-RHCE ~]$ find /var -mtime -4 2> /dev/null | head -3
  /var/lib/dnf
  /var/lib/dnf/history.sqlite
  /var/lib/dnf/history.sqlite-wal
  ```

  ```bash
  # 2. user & group
  # -uid n ：n 为数字，这个数字是使用者的帐号 ID，亦即 UID ，这个 UID 是记录在/etc/passwd 里面与帐号名称对应的数字
  # -gid n ：n 为数字，这个数字是群组名称的 ID，亦即 GID，这个 GID 记录在/etc/group
  # -user name ：name 为使用者帐号名称喔！例如 dmtsai
  # -group name：name 为群组名称喔，例如 users ；
  # -nouser ：寻找文件的拥有者不存在 /etc/passwd 的人！
  # -nogroup ：寻找文件的拥有群组不存在于 /etc/group 的文件！
  
  # 找到/home目錄下所有屬於用戶tutorj的文件
  [tutorj@RHEL8-RHCE ~]$ find /home -user tutorj 2>/dev/null | head -3
  /home/tutorj
  /home/tutorj/.mozilla
  /home/tutorj/.mozilla/extensions
  ```

  ```bash
  # 3. size/type/permission
  # -name filename：搜寻文件名称为 filename 的文件；
  
  # -size [+-]SIZE：搜寻比 SIZE 还要大（+）或小（-）的文件。
  # 这个 SIZE 的规格有：c: 代表 Byte， k: 代表 1024Bytes。所以，要找比 50KB还要大的文件，就是“ -size +50k ”
  
  # -type TYPE ：搜寻文件的类型为 TYPE 的
  # 类型主要有：一般正规文件 （f）, 设备文件 （b, c）,目录 （d）, 链接文件 （l）, socket （s）, 及 FIFO （p） 等属性。
  
  # -perm mode ：搜寻文件权限“刚好等于” mode 的文件，这个 mode 为类似 chmod的属性值
  # 举例来说， -rwsr-xr-x 的属性为 4755 ！
  
  # -perm -mode ：搜寻文件权限“必须要全部囊括 mode 的权限”的文件
  # 举例来说，我们要搜寻 -rwxr--r-- ，亦即 0744 的文件，使用 -perm -0744，当一个文件的权限为 -rwsr-xr-x ，亦即 4755 时，也会被列出来，因为 -rwsr-xr-x 的属性已经囊括了 -rwxr--r-- 的属性了。
  
  # -perm /mode ：搜寻文件权限“包含任一 mode 的权限”的文件
  # 举例来说，我们搜寻-rwxr-xr-x ，亦即 -perm /755 时，但一个文件属性为 -rw-------也会被列出来，因为他有 -rw.... 的属性存在！
  
  # 在/下找到name完全匹配passwd的文件
  [tutorj@RHEL8-RHCE ~]$ find / -name passwd 2>/dev/null | head -3
  /sys/fs/selinux/class/passwd
  /sys/fs/selinux/class/passwd/perms/passwd
  /etc/pam.d/passwd
  
  
  # 在/下找到name匹配*passwd*的文件
  [tutorj@RHEL8-RHCE ~]$ find / -name "*passwd*" 2>/dev/null | head -3
  /sys/fs/selinux/class/passwd
  /sys/fs/selinux/class/passwd/perms/passwd
  /etc/pam.d/passwd
  
  # 在/run下找類型為socket的文件
  [tutorj@RHEL8-RHCE ~]$ find /run -type s 2>/dev/null | head -3
  /run/pcp/pmlogger.2847.socket
  /run/pcp/pmcd.socket
  /run/gssproxy.sock
  
  # 在/下找含SUID/SGID/SBIT的文件
  [tutorj@RHEL8-RHCE ~]$ find / -perm /7000 2>/dev/null | head -3
  /dev/mqueue
  /dev/shm
  /run/stratisd/keyfiles
  ```

  ```bash
  # 4. extra
  # -exec command ：command 为其他指令，-exec 后面可再接额外的指令来处理搜寻到的结果
  # 	range: -exec ~ \; 
  #   相當於把-exec前面的輸出作爲後面指令的參數放入{}中
  [tutorj@RHEL8-RHCE ~]$ find / -perm /7000 2>/dev/null -exec ls -l {} \;
  ```
  
